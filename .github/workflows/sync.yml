name: ğŸ”„ Sync fork with upstream

on:
  schedule:
    - cron: '0 4 * * *'  # æ¯å¤© UTC 3ç‚¹è¿è¡Œï¼ˆåŒ—äº¬æ—¶é—´ 11ç‚¹ï¼‰
  workflow_dispatch:     # å…è®¸æ‰‹åŠ¨è§¦å‘

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ›ï¸ Checkout your fork
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          fetch-depth: 0  # è·å–å®Œæ•´å†å²

      - name: ğŸ”— Set upstream remote
        run: |
          # ğŸ‘‡ æ›¿æ¢ä¸ºä½  Fork çš„åŸå§‹ä»“åº“åœ°å€ï¼ˆé‡è¦ï¼ï¼‰
          git remote add upstream https://github.com/openclaw/openclaw.git
          git fetch upstream

      - name: ğŸ”„ Merge upstream into main
        run: |
          BRANCH="main"  # ğŸ‘ˆ å¦‚æœåŸé¡¹ç›®ç”¨ masterï¼Œè¯·æ”¹æˆ "master"
          
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          
          # å°è¯•åˆå¹¶ upstream/main åˆ°æœ¬åœ°
          git merge upstream/$BRANCH || echo "No new changes or merge conflict."

      - name: ğŸ“¤ Force push to your fork
        run: |
          BRANCH="main"  # ğŸ‘ˆ åŒä¸Šï¼Œä¿æŒä¸€è‡´
          # ä½¿ç”¨ --force-with-lease å®‰å…¨å¼ºåˆ¶æ¨é€
          git push --force-with-lease origin $BRANCH
